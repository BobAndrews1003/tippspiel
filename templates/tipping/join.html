{% include "tipping/_nav.html" %}

<div style="max-width:620px; margin: 0 auto;">

  <h2 style="margin-bottom:10px;">Unirse a un grupo</h2>
  <p style="color:#666; margin-top:0;">
    Introduce el c√≥digo para unirte a un grupo existente.
  </p>

  {% if messages %}
    <div style="margin:12px 0;">
      {% for message in messages %}
        <div style="padding:10px 12px; border:1px solid #eee; border-radius:10px; margin-bottom:8px;">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- JOIN FORM -->
  <form method="post" style="margin-top:12px;">
    {% csrf_token %}
    <label style="display:block; font-size:13px; color:#555; margin-bottom:6px;">
      Join-Code
    </label>
    <input name="code"
           value="{{ code|default:'' }}"
           placeholder="z.B. A1B2C3"
           style="width:100%; padding:10px 12px; border:1px solid #ddd; border-radius:10px; font-size:14px;"
           required>
    <button type="submit"
            style="margin-top:12px; width:100%; padding:10px 12px; border:0; border-radius:10px; background:#0077cc; color:#fff; font-size:14px; cursor:pointer;">
      Unirse
    </button>
  </form>

  <hr style="margin:28px 0; border:0; border-top:1px solid #eee;">

  <!-- CREATE GROUP -->
  <h3 style="margin:0 0 8px;">Todavia sin grupo?</h3>
  <p style="color:#666; margin-top:0;">Entonces crea tu grupo propio en 30 segundos.</p>

  <a href="{% url 'create_group' %}"
     style="display:inline-block; padding:10px 12px; border-radius:10px; border:1px solid #ddd; text-decoration:none; color:#333;">
    Crear grupo
  </a>

  <!-- USER GROUPS SECTION -->
  {% if user_groups %}
  <hr style="margin:32px 0; border:0; border-top:1px solid #eee;">

  <h3 style="margin-bottom:14px;">Tus grupos</h3>

  {% for membership in user_groups %}
    <div style="padding:14px; border:1px solid #eee; border-radius:12px; margin-bottom:12px; background:#fafafa;">

      <div style="display:flex; justify-content:space-between; align-items:center;">

        <div>
          <strong>{{ membership.group.name }}</strong><br>
          <span style="font-size:13px; color:#777;">
            Turnier: {{ membership.group.tournament.name }}
          </span>

          {% if membership.group.id == active_group_id %}
            <div style="font-size:12px; color:#0077cc; margin-top:4px;">
              Grupo activo
            </div>
          {% endif %}

          {% if membership.is_creator %}
            <div style="font-size:12px; margin-top:6px;">
              <strong>Join-Code:</strong>
              <span style="font-family:monospace; letter-spacing:1px;">
                {{ membership.group.join_code }}
              </span>
            </div>
          {% endif %}
        </div>

        <!-- SWITCH BUTTON -->
        <form method="post" action="{% url 'set_active_group' %}">
          {% csrf_token %}
          <input type="hidden" name="group_id" value="{{ membership.group.id }}">
          <button type="submit"
                  style="padding:6px 10px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer;">
            Cambiar
          </button>
        </form>

      </div>
    </div>
  {% endfor %}
  {% endif %}

</div>
