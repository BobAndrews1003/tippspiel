{% extends "tipping/base.html" %}

{% block title %}Unirse a un grupo{% endblock %}

{% block content %}
<div class="container">
  <div class="card" style="max-width:620px; margin:0 auto;">

    <h2 style="margin-bottom:10px;">Unirse a un grupo</h2>
    <p class="muted" style="margin-top:0;">
      Introduce el c√≥digo para unirte a un grupo existente.
    </p>

    {% if messages %}
      <div class="stack" style="margin:12px 0;">
        {% for message in messages %}
          <div class="alert">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- JOIN FORM -->
    <form method="post" style="margin-top:12px;">
      {% csrf_token %}

      <div class="field">
        <label>Join-Code</label>
        <input class="input"
               name="code"
               value="{{ code|default:'' }}"
               placeholder="z.B. A1B2C3"
               required>
      </div>

      <button type="submit" class="btn primary" style="margin-top:12px; width:100%;">
        Unirse
      </button>
    </form>

    <hr style="margin:28px 0; border:0; border-top:1px solid var(--border);">

    <!-- CREATE GROUP -->
    <h3 style="margin:0 0 8px;">Todavia sin grupo?</h3>
    <p class="muted" style="margin-top:0;">Entonces crea tu grupo propio en 30 segundos.</p>

    <a href="{% url 'create_group' %}" class="btn">
      Crear grupo
    </a>

    <!-- USER GROUPS SECTION -->
    {% if user_groups %}
      <hr style="margin:32px 0; border:0; border-top:1px solid var(--border);">

      <h3 style="margin-bottom:14px;">Tus grupos</h3>

      {% for membership in user_groups %}
        <div class="card" style="margin-bottom:12px; background: rgba(255,255,255,.03);">

          <div class="header-flex">

            <div>
              <strong>{{ membership.group.name }}</strong><br>
              <span class="small muted">
                Turnier: {{ membership.group.tournament.name }}
              </span>

              {% if membership.group.id == active_group_id %}
                <div class="small" style="color: var(--brand); margin-top:4px; font-weight:700;">
                  Grupo activo
                </div>
              {% endif %}

              {% if membership.is_creator %}
                <div class="small" style="margin-top:6px;">
                  <strong>Join-Code:</strong>
                  <span style="font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; letter-spacing:1px;">
                    {{ membership.group.join_code }}
                  </span>
                </div>
              {% endif %}
            </div>

            <!-- SWITCH BUTTON -->
            <form method="post" action="{% url 'set_active_group' %}">
              {% csrf_token %}
              <input type="hidden" name="group_id" value="{{ membership.group.id }}">
              <button type="submit" class="btn small">
                Cambiar
              </button>
            </form>

          </div>
        </div>
      {% endfor %}
    {% endif %}

  </div>
</div>
{% endblock %}