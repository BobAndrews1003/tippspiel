{% load static %}
<link rel="stylesheet" href="{% static 'app.css' %}">

{% include "tipping/_nav.html" %}

<div class="container">

  <!-- Header -->
  <div class="card header-card">
    <div class="header-flex">
      <div>
        <h2>Tabla general</h2>
      </div>

      <div class="toolbar-nav">
        <a class="btn small {% if prev_from is None %}disabled{% endif %}"
           href="{% url 'tabelle' %}?view={{ view }}&from={{ prev_from }}&count={{ count }}">
           ◀
        </a>

        <a class="btn small {% if next_from is None %}disabled{% endif %}"
           href="{% url 'tabelle' %}?view={{ view }}&from={{ next_from }}&count={{ count }}">
           ▶
        </a>
      </div>
    </div>

    <div class="muted small">
      Vista actual: Fecha {{ shown_matchdays|first }}–{{ shown_matchdays|last }}
      ({{ shown_matchdays|length }}) de {{ matchdays|length }}
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs-modern">
    <a class="tab-modern {% if view == 'mdpoints' %}active{% endif %}"
       href="{% url 'tabelle' %}?view=mdpoints">
       Puntos por fecha
    </a>

    <a class="tab-modern {% if view == 'ranks' %}active{% endif %}"
       href="{% url 'tabelle' %}?view=ranks">
       Posiciones
    </a>

    <a class="tab-modern {% if view == 'rankdiff' %}active{% endif %}"
       href="{% url 'tabelle' %}?view=rankdiff">
       Diferencia
    </a>
  </div>

  <!-- Table -->
  <div class="card table-card">
    <div class="tablewrap-modern">
      <table>
        <thead>
          <tr>
            <th class="sticky-left pos">Pos</th>
            <th class="sticky-left name">Nombre</th>

            {% for md in shown_matchdays %}
              <th>{{ md }}</th>
            {% endfor %}

            <th class="sticky-right total">Suma</th>
          </tr>
        </thead>

        <tbody>
          {% for r in table_rows %}
            <tr class="{% if r.user.id == me_id %}me{% endif %}">
              <td class="sticky-left pos">{{ forloop.counter }}.</td>

              <td class="sticky-left name">
                <a href="{% url 'user_stats' r.user.id %}">
                  {{ r.user.username }}
                </a>
              </td>

              {% for c in r.cells %}
                <td>
                  {% if c is None %}
                    <span class="muted">—</span>
                  {% else %}
                    {{ c }}
                  {% endif %}
                </td>
              {% endfor %}

              <td class="sticky-right total">{{ r.total }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>